# 
# HelloWorld Apache 2.0 Configuration
#
#   _                            
#  | |                           
#  | |__   ___  __ ___   ___   _ 
#  | '_ \ / _ \/ _` \ \ / / | | |
#  | | | |  __/ (_| |\ V /| |_| |
#  |_| |_|\___|\__,_| \_/  \__, |
#                           __/ |
#                          |___/ 
#
#   THE HEAVY (back-end) SERVER 
#        __               __
#   ____/ /__ _   _____  / /
#  / __  / _ \ | / / _ \/ / 
# / /_/ /  __/ |/ /  __/ /  
# \__,_/\___/|___/\___/_/   
#                                     
#
#
#-------------------------------------------
ServerRoot "/etc/apache2"
LockFile /var/lock/apache2/accept-heavy.lock
PidFile /var/run/apache2-heavy.pid
Timeout 300
KeepAlive Off
HostnameLookups Off
ServerName 127.0.0.1

#
# Modules
#
LoadModule apreq_module /usr/lib/apache2/modules/mod_apreq2.so
LoadModule setenvif_module /usr/lib/apache2/modules/mod_setenvif.so
LoadModule headers_module /usr/lib/apache2/modules/mod_headers.so
<IfModule mod_deflate.c>
          AddOutputFilterByType DEFLATE text/html text/plain text/xml
</IfModule>
LoadModule deflate_module /usr/lib/apache2/modules/mod_deflate.so
LoadModule perl_module /usr/lib/apache2/modules/mod_perl.so
LoadModule status_module /usr/lib/apache2/modules/mod_status.so

User www-data
Group www-data

#
# Logs
#
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
CustomLog /var/log/apache2/access-heavy.log combined
ErrorLog /var/log/apache2/error.log
LogLevel warn
TransferLog "|rotatelogs /tmp 5M"


########################################################################
# prefork MPM
# StartServers: number of server processes to start
# MinSpareServers: minimum number of server processes which are kept spare
# MaxSpareServers: maximum number of server processes which are kept spare
# MaxClients: maximum number of server processes allowed to start
# MaxRequestsPerChild: maximum number of requests a server process serves
StartServers            1
MinSpareServers         3
MaxSpareServers         3
MaxClients              10

MaxRequestsPerChild     0
# PARa que reinicie cada vez que haces F5
#MaxRequestsPerChild     1	

########################################################################
ServerSignature Off
ServerTokens Prod

########################################################################
PerlSwitches -I/helloworld/perl -I/Library/Perl/5.10 

#---------------------------------------------------------
Listen 12358

<VirtualHost *:12358>


    ErrorDocument 404 /notfound

    # Not 100% usefull, since it is RESET in PerlPostReadRequestHandler
    ServerName helloworld.com
    ServerAlias helloworld.com.ar.loc

	DocumentRoot /helloworld/htdocs

#    ErrorDocument 500 "500 - Don't forget that errors are oportunitties"

    PerlOptions +GlobalRequest
	
       PerlLoadModule locale;
       PerlLoadModule POSIX;
       PerlLoadModule Clone;
       PerlLoadModule CGI::Carp;
       PerlLoadModule URI::Escape qw(uri_escape);
       PerlLoadModule Apache2::Cookie;
       PerlLoadModule Apache2::Request;
       PerlLoadModule Apache2::Upload;
       PerlLoadModule DBD::mysql;
       PerlLoadModule DBI;
       PerlLoadModule Apache::DBI;
       PerlLoadModule Locale::Messages;

        PerlSetVar main_dir        /helloworld
        PerlSetVar server_type    devel 

	PerlPostReadRequestHandler NC::PostReadHandler
	<Location />
        SetHandler modperl
    	PerlResponseHandler NC::Handler

        # Insert filter
        SetOutputFilter DEFLATE

        # Netscape 4.x has some problems...
        BrowserMatch ^Mozilla/4 gzip-only-text/html

        # Netscape 4.06-4.08 have some more problems
        BrowserMatch ^Mozilla/4\.0[678] no-gzip

        # MSIE masquerades as Netscape, but it is fine
        # BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

        # NOTE: Due to a bug in mod_setenvif up to Apache 2.0.48
        # the above regex won't work. You can use the following
        # workaround to get the desired effect:
        BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

        # Make sure proxies don't deliver the wrong content
    	Header append Vary User-Agent env=!dont-vary

	</Location>

    <IfModule mod_status.c>
#
# Allow server status reports generated by mod_status,
# with the URL of http://servername/server-status
# Uncomment and change the ".example.com" to allow
# access from other hosts.
#
    <Location /server-status>
    SetHandler server-status

    # All this should be restricted from OS!!
    #    Allow from localhost ip6-localhost
    </Location>

    </IfModule>


</VirtualHost>

